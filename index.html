<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Kelime Oyunu - Çok Oyunculu</title>
    <meta name="theme-color" content="#111827"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg%2xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20192%20192'%20width='192'%20height='192'%3E%3Crect%20width='192'%20height='192'%20rx='32'%20fill='%23111827'/%3E%3Ctext%20x='50%25'%20y='50%25'%20dominant-baseline='central'%20text-anchor='middle'%20font-size='120'%20font-family='Arial,%20sans-serif'%20font-weight='bold'%20fill='%23ffffff'%3EK%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        html, body { 
            height: 100vh; 
            height: -webkit-fill-available; /* iOS Safari için tam ekran yüksekliği */
            overflow: hidden; 
        }
        body { font-family: 'Inter', sans-serif; touch-action: manipulation; display: flex; flex-direction: column; }
        .tile { 
            width: 100%; 
            padding-bottom: 100%; 
            position: relative; 
            border: 2px solid #4b5563; 
            display: flex; /* Flexbox eklendi */
            justify-content: center; 
            align-items: center; /* Flexbox eklendi */
            font-size: 2rem; 
            font-weight: bold; 
            text-transform: uppercase; 
            transition: all 0.3s ease; 
        }
        .tile-inner { 
            position: absolute; 
            top: 0; left: 0; right: 0; bottom: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            line-height: 1; /* Satır yüksekliği düzeltildi */
        }
        .tile.correct { background-color: #10b981; border-color: #10b981; color: white; }
        .tile.present { background-color: #f59e0b; border-color: #f59e0b; color: white; }
        .tile.absent { background-color: #374151; border-color: #374151; color: white; }
        .tile.failed { background-color: #ef4444; border-color: #ef4444; color: white; }
        .keyboard-key { 
            transition: background-color 0.2s; 
            height: 45px; /* Klavye tuş yüksekliği azaltıldı */
        }
        .keyboard-key.correct { background-color: #10b981 !important; color: white; }
        .keyboard-key.present { background-color: #f59e0b !important; color: white; }
        .keyboard-key.absent { background-color: #374151 !important; color: white; }
        .toast { visibility: hidden; opacity: 0; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 100; left: 50%; transform: translateX(-50%); bottom: 50px; transition: opacity 0.5s, visibility 0.5s, bottom 0.5s; }
        .toast.show { visibility: visible; opacity: 1; bottom: 70px; }
        .pulsate { animation: pulsate-bck 1s ease-in-out infinite both; }
        @keyframes pulsate-bck { 0% { transform: scale(1); } 50% { transform: scale(0.9); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <div id="app" class="w-full max-w-md mx-auto flex flex-col h-full p-2">
        <!-- Kurulum Ekranı -->
        <div id="setup-screen" class="text-center bg-gray-800 p-4 rounded-lg shadow-lg flex-1 flex flex-col justify-center">
            <h1 class="text-4xl font-bold text-center mb-6">Kelime Yarışması</h1>
            <div class="mb-4">
                <input type="text" id="username-input" placeholder="Kullanıcı Adını Gir" class="w-full p-2 border rounded-md bg-gray-700 border-gray-600 mb-4 text-center text-white" maxlength="12">
                <h2 class="text-2xl font-semibold mb-3">Yeni Oyun Kur</h2>
                <select id="word-length-select" class="w-full p-2 border rounded-md bg-gray-700 border-gray-600 mb-3 text-white">
                    <option value="4">4 Harfli</option>
                    <option value="5" selected>5 Harfli</option>
                    <option value="6">6 Harfli</option>
                    <option value="7">7 Harfli</option>
                </select>
                <button id="create-game-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg text-lg" disabled>Oyun Kur</button>
            </div>
            <hr class="my-4 border-gray-600">
            <div>
                <h2 class="text-2xl font-semibold mb-3">Oyuna Katıl</h2>
                <input type="text" id="game-id-input" placeholder="Oyun ID'sini girin" class="w-full p-2 border rounded-md bg-gray-700 border-gray-600 mb-3 text-center uppercase text-white placeholder-red-500">
                <button id="join-game-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-lg" disabled>Oyuna Katıl</button>
            </div>
        </div>
        <!-- Oyun Ekranı -->
        <div id="game-screen" class="hidden flex-1 flex flex-col items-center">
             <div class="w-full bg-gray-800 p-2 rounded-lg shadow flex items-center justify-between flex-shrink-0">
                <div id="player1-score" class="text-left w-2/5 truncate"></div>
                <div class="text-center w-1/5">
                    <p id="turn-display" class="font-bold text-md"></p>
                    <p id="timer-display" class="font-bold text-xl font-mono text-gray-300"></p>
                </div>
                <div id="player2-score" class="text-right w-2/5 truncate"></div>
            </div>
            
            <div class="w-full text-center py-1 flex justify-between items-center px-2 flex-shrink-0">
                 <p class="text-xs">Oyun ID: <strong id="game-id-display" class="text-indigo-400"></strong></p>
                 <button id="leave-game-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm">Ayrıl</button>
            </div>
            
            <div class="w-full flex-grow flex flex-col justify-center py-1">
                <div id="guess-grid" class="grid gap-1 w-full" style="max-width: 340px; margin: 0 auto;"></div>
            </div>

            <button id="start-game-btn" class="hidden w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-4 rounded-lg text-lg my-1 flex-shrink-0">Oyunu Başlat</button>
            <div id="keyboard" class="w-full flex-shrink-0"></div>
        </div>
        
        <!-- Maç Sonucu Ekranı -->
        <div id="scoreboard-screen" class="hidden text-center bg-gray-800 p-4 rounded-lg shadow-lg flex-1 flex flex-col justify-center">
            <h2 id="round-winner-display" class="text-3xl font-bold mb-4"></h2>
            <p class="mb-4">Doğru Kelime: <strong id="correct-word-display" class="text-green-400"></strong></p>
            <div id="final-scores" class="w-full max-w-xs mx-auto mb-6 text-left"></div>
            <button id="new-round-btn" class="hidden w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-4 rounded-lg text-lg mb-3">Yeni Tura Başla</button>
            <button id="main-menu-btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg text-lg">Ana Menüye Dön</button>
        </div>

    </div>
    <div id="toast" class="toast"></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        // --- GENİŞLETİLMİŞ KELİME LİSTELERİ ---
        const kelimeler4 = ["ABLA","ACAR","AFET","AĞAÇ","AĞRI","AİLE","AKAR","AKIL","AKIM","AKIN","AKİS","AKLI","AKOR","AKSU","ALAN","ALAY","ALEM","ALET","ALEV","ALGI","ALIM","AMCA","AMEL","AMİN","AMİR","ANKA","ANLAM","ANNE","ARAP","ARDA","ARGO","ARKA","ARMA","ARPA","ARSA","ASAL","ASAP","ASIK","ASIL","ASIM","ASIR","ASİT","ASKI","ASLA","ASLI","ASMA","AŞÇI","AŞIK","AŞIM","AŞIRI","AŞK","AŞMA","ATAK","ATEŞ","ATIF","ATIK","ATIL","ATIM","ATIŞ","ATKI","ATLI","ATMA","ATOM","AVCI","AVLU","AYAK","AYAN","AYAR","AYAZ","AYET","AYIN","AYIP","AYLI","AYNA","AYNI","AYRI","AYVA","AZAP","AZAT","AZI","AZİM","BABA","BACA","BAĞI","BAKI","BALE","BANA","BANK","BANT","BARI","BARO","BASI","BAŞI","BATI","BEL","BELA","BENT","BERE","BERK","BESİ","BEY","BİLE","BİNA","BİRA","BOĞA","BOKS","BOM","BORÇ","BORU","BOŞ","BOYA","BURÇ","BURS","BÜRO","CADI","CAM","CAN","CARİ","CELP","CENK","CEP","CEZA","CİLT","CİPS","CUMA","ÇABA","ÇAĞ","ÇAKI","ÇALI","ÇAM","ÇAN","ÇAP","ÇARK","ÇATI","ÇAY","ÇENE","ÇERİ","ÇETE","ÇIKI","ÇITA","ÇİZİ","ÇOK","ÇÖL","DAHA","DAHİ","DAİM","DAİR","DAMA","DANA","DANS","DARA","DARP","DAVA","DAYI","DEDE","DEFO","DEĞİ","DELİ","DEM","DENİ","DENK","DEPO","DERE","DERİ","DERS","DERT","DEVA","DİNÇ","DİNİ","DİSK","DİŞİ","DİZİ","DOĞA","DOĞU","DOKU","DOLU","DONE","DORU","DOST","DÖRT","DRAM","DUA","DUL","DURU","DUŞ","DUYU","DÜN","DÜŞ","DÜZ","ECZA","EDA","EDAT","EDEP","EĞİM","EĞİR","EĞRİ","EKİM","EKİN","EKLİ","EKME","EKSİ","ELÇİ","ELDE","ELEK","ELEM","ELİF","ELİM","ELLİ","ELMA","EMEK","EMEL","EMİN","EMİR","EMMİ","ENEZ","ENİK","ENSE","EPEY","ERİK","ERİL","ERİM","ERİN","ERKE","ERME","ESAS","ESER","ESİN","ESİR","ESKİ","ESMA","ESME","EŞEK","EŞEY","EŞİK","EŞİT","EŞLİ","EŞME","ETAP","ETÇİ","ETEK","ETİK","ETİL","ETKİ","ETLİ","ETÜT","EVCE","EVCİ","EVET","EVİN","EVLİ","EZAN","EZEL","EZGİ","EZİK","FABl","FAİK","FAİL","FAİZ","FAKS","FANİ","FARK","FARS","FARZ","FAUL","FEDA","FENA","FERÇ","FERİ","FERT","FİDE","FİİL","FİLE","FİLM","FİLO","FİRE","FİŞE","FLAŞ","FOK","FOL","FONT","FORA","FORM","FORS","FOŞA","FOTA","FOTO","FOYA","FREN","FUAR","GALA","GAMA","GASP","GAYE","GAZA","GAZİ","GECE","GEÇE","GELİ","GEMİ","GENÇ","GENE","GERİ","GEZİ","GIDA","GİBİ","GİŞE","GOLF","GÖÇ","GÖK","GÖL","GÖRE","GÖRK","GÖZ","GREV","GRİ","GÜCE","GÜÇ","GÜL","GÜN","GÜR","GÜZ","HACI","HAİL","HAK","HAKİ","HALA","HALE","HALI","HALK","HALT","HAMİ","HANE","HAPİ","HARA","HARÇ","HARF","HARP","HAS","HAŞA","HATA","HAVA","HAVİ","HAYR","HAZ","HEBA","HECE","HELE","HER","HERK","HEVES","HIZ","HİBE","HİLE","HİS","HOCA","HORA","HOŞ","HULK","HUY","HÜDA","HÜKM","İADE","İAŞE","İCAT","İÇEL","İÇİM","İÇİN","İÇİT","İÇKİ","İÇLİ","İDAM","İDEA","İFSA","İHYA","İKAZ","İKNA","İKON","İLAÇ","İLAH","İLAM","İLAN","İLÇE","İLGE","İLGİ","İLKE","İLLE","İLLİ","İLME","İMAL","İMAM","İMAN","İMAR","İMHA","İMLA","İNCE","İNCİ","İNEK","İNHA","İNK","İNME","İNTİ","İPÇİ","İPEK","İPOTEK","İRAN","İRİN","İRİS","İRJA","İRSİ","İSAL","İSİM","İSLİ","İSOT","İSVE","İŞTE","İTAP","İTÇE","İTFA","İTME","İYİ","İZALE","İZAN","JANT","JAPON","JEST","JİLE","JÖLE","JÜRİ","KABA","KABE","KABİ","KABl","KAFA","KAFE","KAİL","KAİM","KALA","KALE","KALP","KAMA","KAME","KAMP","KAMU","KANA","KANİ","KANO","KAPI","KARA","KARE","KARI","KARO","KARS","KART","KASA","KASE","KAŞE","KATI","KAVİ","KAZA","KAZI","KEÇE","KEÇİ","KEDİ","KEFE","KEKA","KEKE","KELE","KEME","KENE","KENT","KERE","KESİ","KEZA","KİLE","KİLO","KİMİ","KİRA","KİVİ","KLASİK","KLON","KOCA","KOÇ","KOKA","KOKU","KOLA","KOLİ","KOMA","KOMBİ","KOMİ","KONA","KONT","KONU","KONYA","KOPÇA","KOPYA","KORA","KORO","KORT","KOŞA","KOŞU","KOTA","KÖLE","KÖRE","KÖSE","KÖŞE","KÖŞK","KÖTÜ","KÖY","KREM","KREP","KROM","KRON","KROS","KULE","KULP","KUMA","KUPA","KURA","KURT","KURU","KUTU","KUZU","KÜFE","KÜLT","KÜME","KÜNH","KÜPE","KÜRE","LALE","LAMA","LAVA","LAZA","LEKE","LENF","LENS","LİCE","LİDER","LİGA","LİKA","LİME","LİNÇ","LİRA","LİSE","LOBİ","LODA","LOGO","LORT","LUTR","LÜKS","MAAŞ","MABAT","MABET","MACUN","MAÇ","MADA","MADD","MADDİ","MAL","MALA","MALÇ","MALİ","MALT","MANA","MANİ","MANO","MAPA","MARJ","MARK","MARS","MARŞ","MASA","MAŞA","MAVİ","MAZI","MEAL","MEKE","MENİ","MENÜ","MERA","MERİ","MEŞE","META","MİAT","MİÇO","MİDE","MİKA","MİNE","MİNİ","MİNK","MİRA","MİSO","MODA","MOKA","MOLA","MONT","MOR","MORG","MOTO","MUAF","MUİN","MUTİ","MÜFT","MÜLK","MÜZE","NAAT","NABİ","NAÇİ","NAFİ","NAİL","NAİP","NAKI","NAKİ","NAL","NANE","NARA","NARH","NAŞİ","NATO","NAZİ","NECA","NECE","NECİ","NEFT","NEHİ","NEMA","NENE","NEON","NERE","NESİ","NEŞE","NEZT","NİCE","NİDA","NİNE","NİSA","NİŞA","NİTE","NİYE","NİZA","NOTA","NOVA","NÖTR","NÜKS","OBJE","OBUA","OBUR","OCAK","ODAK","ODUN","OFİS","OĞAN","OĞUL","OKAR","OKEY","OKKA","OKUL","OKUR","OLAN","OLAY","OLDU","OLGU","OLMA","OLTA","OLUK","OLUR","OMCA","OMUR","OMUZ","ONAR","ONAT","ONAY","ONCA","ONİKS","ONLU","ONMA","ONUR","OPAK","OPAL","OPERA","ORAK","ORAL","ORAN","ORSA","ORTA","ORUÇ","ORYA","OTÇU","OTEL","OTLU","OTSU","OVAL","OVMA","OYMA","OYSA","OYUK","OYUM","OYUN","OZAN","ÖBÜR","ÖDEM","ÖDEV","ÖDÜN","ÖFKE","ÖĞLE","ÖĞÜN","ÖKÇE","ÖLÇÜ","ÖLME","ÖLÜ","ÖMÜR","ÖNAL","ÖNCE","ÖNCÜ","ÖNEL","ÖNEM","ÖYKÜ","ÖYLE","ÖZDE","ÖZEN","ÖZET","ÖZGE","ÖZGÜ","ÖZNE","ÖZÜ","PARA","PARK","PARS","PASO","PATİ","PİKE","PİLE","PİPO","PİRİ","PİSİ","PİST","PLAJ","PLAN","POTA","POZ","PRENS","PRES","PRİM","PRİZ","PUAN","PUMA","PUNT","PUPA","PUSU","RAKİ","RAMP","RANT","RAST","REEL","REİS","RENK","REPO","REVA","REYE","RING","RİNA","RİSK","RİYA","ROBA","ROKA","ROTA","ROZA","RÖLE","RUAM","RUBA","RULO","RUM","RUT","SAAT","SABA","SABO","SAÇ","SADE","SAFİ","SAGA","SAĞI","SAHA","SAHİ","SAİK","SAİR","SAKA","SAKİ","SAL","SALA","SALİ","SALT","SANA","SANI","SAPA","SARA","SARF","SARI","SARP","SATİ","SAVA","SAYE","SAYI","SEÇİ","SEDA","SEFA","SEKS","SELE","SELİ","SEMA","SEME","SEMT","SENA","SENE","SENT","SEPET","SERA","SERE","SERF","SERİ","SERT","SESİ","SEVİ","SEVK","SEYİ","SEZİ","SIHH","SIKI","SILA","SIRA","SIRP","SİLO","SİMA","SİNE","SİNİ","SİRK","SİTE","SOBA","SOBE","SODA","SOFA","SOFİ","SOFU","SOKA","SOLO","SOMA","SONA","SONE","SONG","SORU","SOYA","SPOR","SPOT","STİL","STOK","STOR","SUBAY","SULF","SULH","SUMA","SUNA","SUNİ","SUNU","SURA","SURE","SÜET","SÜJE","SÜNE","SÜRE","ŞAİR","ŞALE","ŞALİ","ŞAMA","ŞANS","ŞARK","ŞART","ŞASE","ŞASİ","ŞAYİ","ŞEF","ŞEHİ","ŞEKİ","ŞEMS","ŞERH","ŞERİ","ŞEVK","ŞEYH","ŞİFA","ŞİKE","ŞİLE","ŞİLT","ŞİRK","ŞİŞE","ŞOKE","ŞORT","ŞOSE","ŞOVM","ŞUBE","ŞULE","ŞURA","ŞUUR","TABİ","TABL","TABU","TAÇ","TAHT","TAKA","TAKI","TANE","TANK","TAPA","TAPI","TAPU","TARA","TART","TASA","TAŞI","TAUN","TAVA","TAYF","TAYİ","TELA","TEMA","TERE","TERS","TEST","TEŞR","TİFO","TİKE","TİNER","TİPİ","TİRE","TİTR","TOKA","TON","TOP","TOST","TRİO","TROL","TUBA","TUL","TURA","TUTU","TÜFE","TÜL","TÜYO","UCUZ","UÇAK","UÇMA","UÇUK","UÇUŞ","UĞRA","UĞRU","UKDE","ULAŞ","ULEMA","ULU","ULUS","UMDE","UMMA","UMRE","UMUM","UMUR","UNSUR","UTAN","UYAK","UYDU","UYMA","UYUR","UZAY","ÜÇLÜ","ÜÇÜZ","ÜLEN","ÜLKE","ÜLKER","ÜNİTE","ÜREM","ÜSTE","ÜVEY","VADE","VADİ","VAHA","VAHİ","VAİZ","VAKA","VAKİ","VAKS","VALE","VALİ","VANA","VARİ","VARO","VARŞ","VASİ","VATO","VİDA","VİDO","VİRA","VİZE","VOLE","VOLİ","VOLT","YABA","YAKA","YAKI","YALI","YAMA","YARI","YASA","YAŞA","YAVE","YAYA","YAZI","YEDİ","YEİS","YEKE","YELE","YEME","YENİ","YİNE","YİRM","YİV","YOGA","YOLA","YONT","YÖRE","YURT","YUVA","ZATİ","ZEKA","ZERK","ZEVK","ZİNA","ZİRA","ZİRVE","ZULA"];
        const kelimeler6 = ["ABARTI","ABESLE","ACEMCE","ACİZLİK","ADALET","ADİLANE","AFAKİL","AFERİN","AİLECE","AKAMET","AKARET","AKIBET","AKSİNE","AKTİFİ","ALAMET","ALAYCI","ALEVLİ","ALEYHE","AMBALE","AMNEZİ","ANALİZ","ANINDA","ANKET","ANTİKA","APAREY","ARBEDE","ARMONİ","ASALET","ASAYİŞ","ASKERİ","ASLINA","AŞİKAR","ATÖLYE","AVANTA","AZAMET","AZAPLI","AZONAL","BABACA","BADİRE","BAHANE","BAKİYE","BAKLİY","BANYO","BARDAK","BARİYER","BASİRE","BASKET","BAŞARI","BAŞKAN","BAŞLIK","BAŞROL","BATARYA","BAYRAM","BAZALI","BEDAVA","BEDAYİ","BEGAYE","BEKARE","BELAGİ","BENDİR","BENLİK","BENMAR","BENZİN","BERAAT","BERBAT","BERBER","BERTİK","BESİLE","BESTEC","BEŞERİ","BEYGİR","BEYHUDE","BEYLİK","BİÇARE","BİENAL","BİGUDİ","BİKAM","BİLDİK","BİLEŞİ","BİLGECE","BİLHASS","BİLİNÇ","BİLMEC","BİRAZİ","BİRLİK","BİRTAK","BİSTUR","BİYELİ","BİYOLO","BİZANS","BİZZAT","BOHÇA","BOKSÖR","BOMBE","BORDÜR","BOŞLUK","BOYKOT","BOYUT","BOZGUN","BOZKIR","BÖCEKL","BÖLÜNT","BÖREKL","BRANŞL","BROKOL","BRONŞİ","BRONZL","BUHARA","BUHRAN","BUKAĞI","BULANİ","BULGUR","BUNALİ","BURSİY","BURSLU","BURULG","BÜNYAN","BÜYÜTE","CACIKL","CADALO","CAHİLİ","CAHİL","CAİZE","CAKA","CAMBAZ","CAMDAN","CAMEKA","CAMGÖZ","CAMİA","CANDAN","CANFES","CANHİR","CANLI","CARLI","CARIYE","CARSA","CAVLA","CAYMA","CAYIŞ","CAZİBE","CAZİP","CEBBAR","CEBELİ","CEBREN","CEDEL","CEDİT","CEDRE","CEFAKA","CEHENN","CEKETL","CELALİ","CELİLE","CEMEVİ","CEMİLE","CEMİY","CEMRE","CENAZE","CENDERE","CENGEL","CENNET","CEPHAN","CEPHES","CERAH","CERBEZ","CEREME","CERRAR","CESARE","CESUR","CETVEL","CEVAP","CEVHER","CEZAEN","CİBİNL","CİDDİ","CİGAR","CİHANN","CİHAR","CİHAT","CİHET","CİLAL","CİLTL","CİLVEY","CİMRİ","CİNAYE","CİNNET","CİNSL","CİPSL","CİRİM","CİSİM","CİVAN","CİVAR","CİVCİV","CİYAK","CİZYE","COĞRAF","COKAY","COPCU","COŞKU","COŞMA","COŞUM","CÖMERT","CUMHUR","CÜBBEL","CÜCE","CÜCÜK","CÜDA","CÜLUS","CÜMLE","CÜPPEL","CÜRET","CÜRÜM","CÜSSE","ÇABUC","ÇADIR","ÇAĞDAŞ","ÇAĞLA","ÇAĞRI","ÇAKIL","ÇALGIL","ÇALIŞ","ÇAPRAZ","ÇARŞAF","ÇATLAK","ÇAVDAR","ÇAYDAN","ÇEKİNG","ÇELİŞK","ÇEMBER","ÇENGEL","ÇERÇEV","ÇEŞİTL","ÇETREF","ÇEVREN","ÇEVRİM","ÇEYREK","ÇIKMAZ","ÇIPLAK","ÇIRAKM","ÇİFTLİ","ÇİĞDEM","ÇİKOLA","ÇİLEKL","ÇİMENT","ÇİNGEN","ÇİNKO","ÇİVİLİ","ÇİZELG","ÇİZME","ÇOCUKÇ","ÇOĞUL","ÇORAK","ÇÖMLEK","ÇÖZELT","ÇUBUKL","ÇUKUR","ÇULLUK","ÇÜRÜME","DABAN","DACİK","DADAŞ","DAĞCIK","DAĞDAŞ","DAĞLIK","DAİMA","DAİRE","DAİREV","DAKİK","DALAV","DALCI","DALDA","DALGA","DALGIÇ","DALGIN","DALIZ","DALIŞ","DALKAV","DALMA","DALSI","DALYA","DAMAC","DAMAK","DAMAL","DAMAR","DAMAT","DAMGA","DAMIT","DAMLA","DANIŞ","DANSÖR","DANTEL","DARBE","DARGIN","DARICA","DARPH","DARÜL","DASİT","DATÇA","DAVACI","DAVAR","DAVET","DAVUL","DAVYA","DAYAK","DAYALI","DAYAN","DAYE","DEBDEB","DECİLE","DEFANS","DEFİNE","DEFNET","DEFOYL","DEGÜS","DEHHA","DEİZM","DEKAN","DEKAR","DEKOR","DELAL","DELGİ","DELİL","DELME","DEMEÇ","DEMEK","DEMET","DEMİN","DEMİR","DEMLİ","DEMODE","DENEME","DENET","DENEY","DENGE","DENİM","DENİZ","DENK","DENLİ","DEPAR","DEPOZİ","DEPREM","DEREC","DERGİ","DERHAL","DERİN","DERLEM","DERMAN","DERNEK","DERSİM","DERTÇ","DERTLİ","DERVİŞ","DESEN","DESTE","DESTEK","DEVAİR","DEVAM","DEVCİL","DEVİR","DEVLET","DEVRAN","DEVRİK","DEYİM","DİAGRA","DİBACE","DİDAR","DİDİK","DİDON","DİGİTA","DİĞER","DİKALA","DİKENC","DİKEY","DİKGEN","DİKİLİ","DİKİNE","DİKİŞ","DİKİZ","DİKME","DİKTE","DİLALT","DİLBAZ","DİLCİK","DİLEK","DİLEM","DİLENC","DİLEYİ","DİLFİR","DİLHUN","DİLMAÇ","DİLSİZ","DİNÇ","DİNDAR","DİNEK","DİNGİL","DİNGİN","DİNMEK","DİPLOM","DİRGEN","DİRHEM","DİRİLİ","DİRİLM","DİRSEK","DİSKO","DİSPEÇ","DİŞÇİL","DİŞEME","DİŞLEK","DİVAN","DİYET","DİZDAR","DİZEG","DİZEL","DİZEM","DİZGE","DİZGİN","DİZİLİ","DİZME","DOĞAÇ","DOĞAL","DOĞRAM","DOĞULU","DOĞUM","DOKSAN","DOKTOR","DOKUMA","DOLAP","DOLAY","DOLGU","DOLMA","DOLMUŞ","DOLUSU","DOMBAY","DOMİN","DOMUZ","DONANIM","DÖKME","DÖKÜM","DÖNEÇ","DÖNEL","DÖNEM","DÖNENCE","DÖNER","DÖNGÜ","DÖNME","DÖNÜŞ","DÖŞEK","DÖVME","DÖVÜŞ","DRAMA","DRAMAT","DRİPL","DUBAR","DUBLE","DUDULL","DUHUL","DUYARL","DUYGUN","DUYGUS","DUYMA","DUYURU","DÜELL","DÜĞME","DÜĞÜM","DÜĞÜN","DÜLGER","DÜMDÜZ","DÜNÜR","DÜRBİN","DÜRMEC","DÜRÜM","DÜRÜST","DÜŞEŞ","DÜŞEY","DÜŞKÜN","DÜŞLEM","DÜŞME","DÜŞSEL","DÜŞÜNC","DÜŞÜŞ","DÜZELT","DÜZEN","DÜZEY","DÜZGÜN","DÜZİNE","DÜZLEM","DÜZME","ECDAT","ECNEB","EDEBİ","EDİNİ","EDİRN","EFEKTL","EFEND","EFLATU","EFSAN","EĞİLİ","EĞİTİ","EGEMEN","EGZOTİ","EKİNOK","EKMEKL","EKSEN","EKSİKL","ELAMAN","ELBİSE","ELÇİLİ","ELDİVE","ELEBAŞ","ELEGEÇ","ELEKTR","ELEMEK","ELİYLE","ELLER","ELMA","ELYAF","EMANET","EMARET","EMAYEL","EMİSYO","EMLAKÇ","EMRİND","EMZİKL","ENDER","ENDÜS","ENERJİ","ENEZE","ENFEST","ENGERE","ENGİN","ENİKON","ENİŞTE","ENKAZ","ENLEM","ENTEGR","ENTELE","ERBAP","ERDEML","EREĞL","ERGAN","ERGEN","ERİME","ERİNÇ","ERİŞİ","ERİTE","ERKEKL","ERMEN","EROİN","EROZY","ERSEME","ERSİZ","ERTEK","ERTES","ERZİNC","ESARET","ESASEN","ESASLI","ESKİC","ESKİD","ESKİME","ESKRİ","ESMER","ESNAFL","ESNEKL","ESPRİL","ESSAH","ESTAMP","EŞEKL","EŞİTL","EŞKİY","EŞOFMA","ETAMİN","ETİKET","ETKİLE","ETKİL","ETRAFL","EVHAML","EVLİL","EVVELA","EYALET","EYERLİ","EYLEML","EZBERE","EZGİL","EZİYET"];
        const kelimeler7 = ["ABARTMA","ACİZLİK","ADALETL","ADAPTÖR","ADEMCİL","ADIMLIK","AFORİZM","AĞAÇSIL","AĞIRLIK","AĞLAMAK","AHLAKEN","AHLAKLI","AHTAPOT","AİLECEK","AKADEMİ","AKCİĞER","AKLINCA","AKPELİN","AKRİLİK","AKROBAT","AKSİYON","AKTİFLİ","AKTRİSA","ALABALİ","ALAKALI","ALARM","ALBATRO","ALBÜMİN","ALÇAKÇA","ALDATMA","ALEVLEN","ALEYHTA","ALFASAY","ALİMANE","ALKOLİK","ALLAHÇI","ALLAME","ALMAÇLI","ALMANCA","ALTILIK","ALTINSI","ALTYAPI","ALYUVAR","AMABİLE","AMATÖRL","AMBALAJ","AMBULAN","AMERİKA","AMİGDA","AMİPLİ","AMONYAK","AMORTİS","AMPİRİK","ANADOLU","ANAFORA","ANAHTAR","ANANEVİ","ANARŞİK","ANATOMİ","ANÇÜEZ","ANDAVAL","ANDIZLI","ANEKDOT","ANEMİLİ","ANGARYA","ANIMSAT","ANITSAL","ANKEBÛT","ANKESÖR","ANLAMAK","ANLAMDA","ANLAŞMA","ANLATIM","ANLAYIŞ","ANTEPLİ","ANTETLİ","ANTİKOR","ANTİMON","ANTİPAT","ANTREPO","ANTSAL","APARMAK","APARTMA","APLİKAS","APSEVİ","APSİYON","ARABACI","ARABESK","ARAKÇIL","ARALAMA","ARALIK","ARANMAK","ARAPGİR","ARAPÇA","ARAŞTIR","ARAZBAR","ARAZİLİ","ARBALET","ARBEDEC","ARDIŞIK","ARENALI","ARGANCI","ARGÜMAN","ARITMAK","ARİTMET","ARKADAŞ","ARKALIK","ARMAĞAN","ARMUTLU","AROMALI","ARSENİK","ARŞİDUC","ARŞİNLİ","ARTIKLI","ARTİSTL","ARTVİNL","ARUZ","ARZUHÂL","ASABİYE","ASALAK","ASAR","ASBEST","ASİLZAD","ASİSTAN","ASKERLİ","ASKILIK","ASLANI","ASPARAG","ASPİRİN","ASTARLI","ASTRAGA","ASTROLO","ASTRONO","ASUMAN","AŞAĞILI","AŞÇI","AŞILAMA","AŞINMAK","AŞIRMAK","AŞİYAN","ATARAKS","ATARDAM","ATARLIL","ATILGAN","ATILMAK","ATIP","ATIŞMAK","ATLAMAK","ATLETİK","ATMOSFE","ATOMİZE","ATONAL","AVANTÜR","AVDET","AVİZE","AVLAMAK","AVOKADO","AVUNMAK","AVURTLU","AYAKKAB","AYAKLIK","AYAKSIZ","AYARLAM","AYARTMA","AYAZLIK","AYBASTI","AYDINLI","AYGIRLI","AYIKLAM","AYIRTMA","AYIRTMA","AYRICAL","AYRIKSI","AYRILIK","AYRILMA","AYRINTI","AYTIŞMA","AZALTMA","AZGINLI","AZİMLİ","AZİMKÂR","AZMETME","BABACAN","BABALIK","BACANAK","BADEMLİ","BAĞBOZU","BAĞCIKL","BAĞDAŞI","BAĞIMLI","BAĞIRMA","BAĞIŞIK","BAĞLAMA","BAĞNAZL","BAHARAT","BAHARLI","BAHÇELİ","BAHİSÇİ","BAHŞETM","BAHTSİZ","BAKANAK","BAKANLI","BAKARAK","BAKIMEV","BAKIMLI","BAKIMSI","BAKİREM","BAKİYE","BAKLACI","BAKLALI","BAKRAÇ","BALALAY","BALDIR","BALIKÇI","BALİNA","BALKIMA","BALLAMA","BALTAL","BAMTELİ","BANDAJL","BANDIR","BANDOCU","BANGIR","BANKACI","BANKER","BANYOLU","BAPTİST","BARBARL","BARDAKC","BARET","BARIŞÇI","BARİTL","BARİZ","BAROK","BARSEL","BASAMAK","BASBAYA","BASILMA","BASIMEV","BASİTL","BASKETB","BASKICI","BASKILI","BASTIR","BAŞAKÇ","BAŞARIM","BAŞKALA","BAŞLAMA","BAŞLICA","BAŞYAPA","BATAKÇI","BATANYA","BATARYA","BATIRMA","BATTANİ","BAVL","BAYATLI","BAYILMA","BAYRAML","BAZGİRT","BECERME","BEDBİNL","BEDDUAL","BEĞENME","BEHEM","BEKÇİ","BEKİTME","BELAGAT","BELÇİKA","BELGELİ","BELİRME","BELİRSİ","BELİRTİ","BELKEMİ","BELLEME","BELLİK","BENCİL","BENDE","BENDE","BENİÇİN","BENİM","BENİMKİ","BENİM","BENLİK","BENZEŞ","BENZİN","BERAAT","BERDEL","BEREKET","BERİVAN","BERRAKL","BERTAR","BESBED","BESİCİL","BESLEME","BESTEKÂ","BEŞAMEL","BETONAR","BETONCU","BEYANAT","BEYAZ","BEYGİR","BEYHUDE","BEYKOZ","BEYLİKB","BEYOĞLU","BEZCİLİ","BEZEMEC","BİBERON","BİBLİYO","BİÇİLME","BİÇİMCE","BİÇİMLİ","BİÇKİ","BİDON","BİFAYD","BİGANET","BİKİNI","BİLAKİS","BİLDİRİ","BİLE","BİLEĞ","BİLEŞEN","BİLETE","BİLETLİ","BİLEYCİ","BİLGECE","BİLGİÇ","BİLGİLİ","BİLGİS","BİLGİYA","BİLİM","BİLİMCİ","BİLİNÇ","BİLİNEN","BİLİNME","BİLİRKİ","BİLİŞİM","BİLLUR","BİNİCİL","BİNİNCİ","BİRAZ","BİRER","BİREYSE","BİRİCİK","BİRİKİM","BİRİKME","BİRLİKT","BİSAM","BİSKÜVİ","BİTEK","BİTİK","BİTİM","BİTİMLİ","BİTİRİM","BİTİŞİK","BİTMEK","BİTÜMLÜ","BİYELİ","BİYOGAZ","BİYOLOG","BİYOM","BİYOPSİ","BOCCAC","BOĞDUR","BOĞMACA","BOĞUMSU","BOKSİT","BOKSÖR","BOLDİL","BOL","BOMBEL","BOMBELE","BONCUK","BORDRO","BORNOZ","BORSA","BORSA","BORSA","BOSTAN","BOŞALMA","BOŞANMA","BOŞBOĞA","BOŞNAK","BOYACIL","BOYAHAN","BOYAMAK","BOYDAŞ","BOYNUZ","BOYUNLU","BOZARİK","BOZDOĞA","BOZGUN","BOZKURT","BOZULMA","BOZUŞMA","BÖCEKÇİ","BÖCEKEV","BÖĞÜRME","BÖLEN","BÖLÜNME","BÖN","BÖREKÇİ","BRAHMAN","BRANDA","BRANŞL","BRE","BRİÇ","BRİFİN","BROKER","BROMÜR","BRONŞİT","BROŞÜR","BRÜLÖR","BUCACIK","BUÇUKLU","BUDAKL","BUDİZM","BUD","BUHURDA","BUKLET","BULANIK","BULAŞIK","BULGURL","BULMACA","BULUNAK","BULUNMA","BULUŞMA","BUNALIM","BUNAKLI","BUNGUN","BURADAN","BURGAÇ","BURKUCU","BURSALI","BURUŞUK","BUTAFOR","BUTİK","BUYURMA","BÜLBÜL","BÜNYECE","BÜRÜMEK","BÜRÜNGÜ","BÜTÇESİ","BÜYÜKÇE","BÜYÜLÜ","BÜYÜTME","CAZ","CAZ","CAZGIRL","CEBELLE","CEBİNDE","CEDELCİ","CEFAL","CEHALET","CELB","CEMBİYE","CEMEVİ","CENAHLI","CENİNLİ","CENNET","CENTİLM","CEPÇİLİ","CEPHANE","CEPHESİ","CERAHAT","CİĞERLİ","CİHATÇI","CİHETLİ","CİHANGİ","CİLALAM","CİLTLEN","CİLVESİ","CİMBAR","CİMRİLİ","CİNA","CİNDERE","CİN","CİNSLİK","CİRİTLİ","CİSİMLİ","CİVİLTİ","CİZ","COĞRAFİ","COK","COPLAMAK","COŞKULU","CUMARTES","CUMHURCU","CÜMLETEN","ÇABALAM","ÇABASIZ","ÇADIR","ÇAĞANOZ","ÇAĞILTI","ÇAĞIRMA","ÇAĞLAYA","ÇAKALBO","ÇAKAR","ÇAKILTA","ÇAKINLI","ÇAKIŞMA","ÇALDIRM","ÇALGICI","ÇALIMLI","ÇALINMA","ÇALIŞKA","ÇALIŞMA","ÇALKAMA","ÇALPARA","ÇAM","ÇAMAŞIR","ÇAMFİST","ÇAMURCU","ÇAMURLU","ÇANAKÇI","ÇANDARL","ÇANGALL","ÇANKIRI","ÇAPANOĞ","ÇAPKINL","ÇAPRAŞI","ÇAPULCU","ÇARÇUR","ÇARDAKL","ÇARIKLI","ÇARKIFE","ÇARLİST","ÇARPILI","ÇARPIŞM","ÇARŞILI","ÇATALLI","ÇATAN","ÇATIŞMA","ÇATLAMA","ÇAVDAR","ÇAYCUMA","ÇAYIR","ÇAYKARA","ÇAYLAK","ÇAYL","ÇEDAR","ÇEKİCİL","ÇEKİÇ","ÇEKİLİŞ","ÇEKİLME","ÇEKİMSER","ÇEKİNGEN","ÇEKİRDE","ÇEKİŞME","ÇEKTİRME","ÇELEBİL","ÇELENKL","ÇELİKHAN","ÇELİKSİ","ÇELİŞKİ","ÇELİŞME","ÇELLİST","ÇEMENLİ","ÇEN","ÇENEBAZ","ÇENTMEK","ÇEPELSİ","ÇERÇEV","ÇERÇÖP","ÇEREZCİ","ÇERKEZC","ÇERKEZL","ÇERMİKL","ÇEŞİTLİ","ÇEŞMECİ","ÇETEBAŞ","ÇETREFİ","ÇEVİK","ÇEVİRGE","ÇEVİRİM","ÇEVİRME","ÇEVRELİ","ÇEYREKL","ÇIBANBA","ÇIĞIRMA","ÇIKAGEL","ÇIKAR","ÇIKARLI","ÇIKARMA","ÇIKINTI","ÇIKRIK","ÇILBIR","ÇILDIR","ÇINARLI","ÇINGIRA","ÇIPILT","ÇIRA","ÇIRAKLI","ÇIRPINM","ÇIT","ÇIT","ÇIT","ÇIT","Çİçekçi","ÇİFTEHA","ÇİFTTE","ÇİĞNEME","ÇİKOLAT","ÇİLEKEŞ","ÇİMENTOL","ÇİNCE","ÇİNGENE","ÇİNKO","ÇİN","ÇİVİTLE","ÇİZGİLİ","ÇİZMECİ","ÇOBANLI","ÇOCUKLU","ÇOĞULCU","ÇOĞULLU","ÇOK","ÇOK","ÇOKAL","ÇOK","ÇOK","ÇOKRAĞA","ÇOK","ÇORUM","ÇÖKERTME","ÇÖLLÜK","ÇÖPLENME","ÇUKUR","ÇULLANMA","ÇÜRÜTME","DADAİST","DAĞITIM","DAHİLİY","DAİRESE","DAL","DAL","DALAVER","DALAVERE","DALBASTI","DAL","DAL","DAL","DAL","DAL","DAMAR","DAM","DAM","DAM","DANIŞMA","DANİSKA","DANS","DANS","DARBE","Darbe","DAR","DAR","DAR","DAR","DAR","DAVRANI","DAYANIK","DAYANMA","DEBİL","DEFNETM","DEĞİL","DEĞNEKL","DEHLİZ","DEHŞETL","DEJENERE","DEKANLI","DEKORCU","DEKUPAJ","DELALET","DELİKAN","DELİRME","DELİ","DEM","DEM","DEM","DEM","DEM","DENEME","DEN","DEN","DEN","DEN","DEPOLAM","DEPRESİ","DERECEL","DERİLME","DERİN","DERK","DERLEMC","DERLEYİ","DERTLİ","DESİBEL","DESPOT","DESTE","DESTE","DETAYLI","DETEKTİ","DETERJA","DEVASIZ","DEVELİK","DEVİMS","DEVRALM","DEYİM","DEYYUS","DIŞ","DIŞ","DIŞARID","DIŞAVUR","DIŞBÜKE","DIŞINDA","DIŞKILA","DİBEK","DİFTERİ","DİJİTAL","DİKELME","DİKİLME","DİKKATL","DİKLEME","DİKSİYO","DİL","DİLALT","DİLENCİ","DİLEMM","DİL","DİL","DİNAMİT","DİNAMO","DİNGİLD","DİRENME","DİREY","DİRİLME","DİSK","DİSK","DİSPANÇ","DİSPONİ","DİSTO","DİŞ","DİŞ","DİŞ","DİŞ","DİŞ","DİZİL","DOĞAÇL","DOĞAL","DOĞRAMA","DOĞRUD","DOĞURMA","DOKUMAC","DOLANDI","DOLAPLI","DOLAYLI","DOLDURM","DOLMEN","DOLM","DOL","DOMALT","DOMİNAT","DONATIM","DONDURM","DOPİNG","DOSTANE","DOY","DOY","DOY","DOY","DÖKÜMH","DÖNÜŞLÜ","DRAMATİ","DUBLEKS","DURAKSA","DURULMA","DURUMLU","DUV","DUYARLI","DUYULMA","DÜET","DÜMEN","DÜN","DÜNKÜ","DÜRBÜNL","DÜŞE","DÜŞE","DÜŞEYSE","DÜŞLEME","DÜŞÜNÜR","DÜZ","DÜZAYAK","DÜZENB","DÜZENLE","DÜZENLİ","EBEDÎ","ECZACI","EDEPSİZ","EDİLGEN","EDİMSEL","EDİTÖR","EGOİST","EĞİTİMC","EĞLENCE","EKİLME","EKMEKÇİ","EKOLOJİ","EKONOMİ","EKRAN","EKSİKLİ","EKÜMEN","ELAZIĞ","ELBİSEL","ELEBAŞI","ELEK","ELEK","ELEKTRO","ELEKTRİ","ELEM","ELİNDE","ELİPS","ELİT","ELLEME","ELMAS","ELVERME","EMANET","EMAY","EMEKÇİ","EMEKLİL","EMİLME","EMİRLİK","EMSAL","EMZİK","ENAYİLİ","ENDEK","ENDÜSTR","ENFES","ENFLASY","ENGELLİ","ENİK","ENLEM","ENSE","ENTEGRE","ENTER","ENTERN","ENTİPÜF","ENVA","ENZİM","ERİME","ERİNÇ","ERİŞTE","ERKEKÇE","ERKEKLİ","EROTİZM","ERSELİK","ERTESİ","ESENLİK","ESİNTİL","ESİR","ESKİ","ESKRİM","ESNEKLİ","ESPRİTÜ","ESRAR","ESS","ESTETİK","ESTET","EŞ","EŞ","EŞDEĞE","EŞEYSEL","EŞİT","EŞKENAR","EŞ","EŞZAMAN","ETKİLEŞ","ETKİN","EV","EV","EVCEĞİZ","EVİNDE","EVİRGEN","EVLATLI","EVLİLİK","EVRİLME","EVVELCE","EYERCİ","EZBERCİ","EZELÎ","EZİKLİK"];

        window.addEventListener('load', () => {
            // --- DOM Elements & Global State ---
            const setupScreen = document.getElementById('setup-screen');
            const gameScreen = document.getElementById('game-screen');
            const scoreboardScreen = document.getElementById('scoreboard-screen');
            const guessGrid = document.getElementById('guess-grid');
            const keyboardContainer = document.getElementById('keyboard');
            const toast = document.getElementById('toast');
            const turnDisplay = document.getElementById('turn-display');
            const timerDisplay = document.getElementById('timer-display');
            const startGameBtn = document.getElementById('start-game-btn');
            const createBtn = document.getElementById('create-game-btn');
            const joinBtn = document.getElementById('join-game-btn');
            const mainMenuBtn = document.getElementById('main-menu-btn');
            const newRoundBtn = document.getElementById('new-round-btn');
            const leaveGameBtn = document.getElementById('leave-game-button');
            const gameIdDisplay = document.getElementById('game-id-display');

            let db, auth, userId, currentGameId = null, gameUnsubscribe = null, turnTimerInterval = null;
            let currentRow = 0, isMyTurn = false, isGameOver = false, wordLength = 5, localGameData = null;
            let wordLists = {};
            let validWords = {};

            const scorePoints = [1000, 800, 600, 400, 200, 100];
            const GUESS_COUNT = 6;
            
            const firebaseConfig = {
                apiKey: "AIzaSyA5FcmgM9GV79qGwS8MC3_4yCvwvHZO0iQ",
                authDomain: "kelime-oyunu-flaneur.firebaseapp.com",
                projectId: "kelime-oyunu-flaneur",
                storageBucket: "kelime-oyunu-flaneur.appspot.com",
                messagingSenderId: "888546992121",
                appId: "1:888546992121:web:3e29748729cca6fbbb2728",
                measurementId: "G-RVD6YZ8JYV"
            };

            function showToast(message) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }
            
            function getUsername() {
                let username = document.getElementById('username-input').value.trim();
                if (!username) {
                    username = `Oyuncu${Math.floor(Math.random() * 900) + 100}`;
                }
                return username.slice(0, 12);
            }

            async function createGame() {
                if (!db || !auth || !userId) return showToast("Sunucuya bağlanılamıyor.");
                
                const username = getUsername();
                const selectedLength = parseInt(document.getElementById('word-length-select').value);
                const gameId = Math.random().toString(36).substring(2, 8).toUpperCase();
                const wordList = wordLists[selectedLength];
                if (!wordList || wordList.length === 0) return showToast("Bu uzunlukta kelime listesi bulunamadı.");
                
                const secretWord = wordList[Math.floor(Math.random() * wordList.length)];

                const gameData = {
                    gameId, wordLength: selectedLength, secretWord, creatorId: userId,
                    players: { [userId]: { username, guesses: [], score: 0 } },
                    currentPlayerId: userId, status: 'waiting', winner: null, roundWinner: null, createdAt: new Date(),
                };
                
                try {
                    await firebase.firestore().collection("games").doc(gameId).set(gameData);
                    await joinGame(gameId);
                } catch (error) { console.error("Error creating game:", error); showToast("Oyun oluşturulamadı!"); }
            }

            async function joinGame(gameId) {
                if (!db || !auth || !userId) return showToast("Sunucuya bağlanılamıyor.");
                if (!gameId) return showToast("Lütfen bir Oyun ID'si girin.");
                
                const username = getUsername();
                const gameRef = db.collection("games").doc(gameId);
                
                try {
                    const gameDoc = await gameRef.get();
                    if (!gameDoc.exists) return showToast("Oyun bulunamadı!");

                    const gameData = gameDoc.data();
                    
                    if (Object.keys(gameData.players).length === 1 && !gameData.players[userId]) {
                        const newPlayers = { ...gameData.players, [userId]: { username, guesses: [], score: 0 } };
                        await gameRef.update({ players: newPlayers });
                    } else if (!gameData.players[userId]) {
                        return showToast("Bu oyun dolu veya başlamış.");
                    }

                    currentGameId = gameId;
                    setupScreen.classList.add('hidden');
                    scoreboardScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    listenToGameUpdates(gameId);
                } catch (error) { console.error("Error joining game:", error); showToast("Oyuna katılırken hata oluştu."); }
            }

            function listenToGameUpdates(gameId) {
                if (gameUnsubscribe) gameUnsubscribe();
                const gameRef = db.collection("games").doc(gameId);
                gameUnsubscribe = gameRef.onSnapshot((doc) => {
                    const gameData = doc.data();
                    if (!gameData) {
                        showToast("Oyun sonlandırıldı.");
                        leaveGame();
                        return;
                    }
                    localGameData = gameData;
                    if (gameData.status === 'finished') {
                        showScoreboard(gameData);
                    } else {
                        renderGameState(gameData);
                    }
                });
            }
            
            function leaveGame() {
                if (gameUnsubscribe) gameUnsubscribe();
                stopTurnTimer();
                gameUnsubscribe = null;
                currentGameId = null;
                localGameData = null;
                
                gameScreen.classList.add('hidden');
                scoreboardScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
            }

            function renderGameState(gameData) {
                gameScreen.classList.remove('hidden');
                scoreboardScreen.classList.add('hidden');

                gameIdDisplay.textContent = gameData.gameId;
                wordLength = gameData.wordLength;
                stopTurnTimer();
                isMyTurn = gameData.currentPlayerId === userId && gameData.status === 'playing';
                updateTurnDisplay(gameData);
                updateScores(gameData);
                createGrid();

                const allPlayerIds = Object.keys(gameData.players);
                let totalGuesses = 0;
                for(let i = 0; i < GUESS_COUNT * allPlayerIds.length; i++) {
                    const playerIdForThisTurn = allPlayerIds[i % allPlayerIds.length];
                    const guessIndex = Math.floor(i / allPlayerIds.length);
                    const playerGuesses = gameData.players[playerIdForThisTurn]?.guesses;
                    
                    if (playerGuesses && playerGuesses[guessIndex]) {
                        const { word, colors } = playerGuesses[guessIndex];
                        renderGuess(totalGuesses, word, colors);
                        totalGuesses++;
                    }
                }
                currentRow = totalGuesses;
                
                createKeyboard();
                updateKeyboard(gameData);

                if (isMyTurn) { startTurnTimer(); }
            }
            
            function updateScores(gameData) {
                const playerIds = Object.keys(gameData.players);
                const p1ScoreEl = document.getElementById('player1-score');
                const p2ScoreEl = document.getElementById('player2-score');

                if (playerIds.length > 0) {
                    const p1 = gameData.players[playerIds[0]];
                    p1ScoreEl.innerHTML = `<span class="font-bold">${p1.username}</span><br>${p1.score} Puan`;
                }
                 if (playerIds.length > 1) {
                    const p2 = gameData.players[playerIds[1]];
                    p2ScoreEl.innerHTML = `<span class="font-bold">${p2.username}</span><br>${p2.score} Puan`;
                } else {
                    p2ScoreEl.innerHTML = '';
                }
            }

            function updateTurnDisplay(gameData) {
                const numPlayers = Object.keys(gameData.players).length;
                if (gameData.status === 'waiting') {
                    if (numPlayers < 2) {
                        turnDisplay.textContent = "Rakip bekleniyor...";
                        startGameBtn.classList.add('hidden');
                    } else {
                        if (userId === gameData.creatorId) {
                            turnDisplay.textContent = "Rakip katıldı!";
                            startGameBtn.classList.remove('hidden');
                        } else {
                            turnDisplay.textContent = "Başlatılıyor...";
                            startGameBtn.classList.add('hidden');
                        }
                    }
                } else if (gameData.status === 'playing') {
                    startGameBtn.classList.add('hidden');
                    const currentPlayerUsername = gameData.players[gameData.currentPlayerId]?.username;
                    if (isMyTurn) {
                        turnDisplay.textContent = "Sıra Sende!";
                        turnDisplay.classList.add('pulsate');
                    } else {
                        turnDisplay.textContent = `Sıra: ${currentPlayerUsername}`;
                        turnDisplay.classList.remove('pulsate');
                    }
                }
            }

            function createGrid() {
                guessGrid.innerHTML = '';
                guessGrid.style.gridTemplateColumns = `repeat(${wordLength}, 1fr)`;
                for (let i = 0; i < GUESS_COUNT; i++) {
                    for (let j = 0; j < wordLength; j++) {
                        const tile = document.createElement('div');
                        tile.classList.add('tile');
                        tile.id = `tile-${i}-${j}`;
                        const tileInner = document.createElement('div');
                        tileInner.classList.add('tile-inner');
                        tile.appendChild(tileInner);
                        guessGrid.appendChild(tile);
                    }
                }
            }

            function renderGuess(rowIndex, word, colors) {
                 for (let i = 0; i < wordLength; i++) {
                    const tile = document.getElementById(`tile-${rowIndex}-${i}`);
                    if(tile) {
                        tile.querySelector('.tile-inner').textContent = word[i];
                        tile.classList.add(colors[i]);
                    }
                }
            }

            function createKeyboard() {
                keyboardContainer.innerHTML = '';
                const keyRows = [['E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P', 'Ğ', 'Ü'], ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', 'Ş', 'İ'], ['ENTER', 'Z', 'C', 'V', 'B', 'N', 'M', 'Ö', 'Ç', '⌫']];
                keyRows.forEach(row => {
                    const rowDiv = document.createElement('div');
                    rowDiv.classList.add('flex', 'justify-center', 'gap-1', 'my-1');
                    row.forEach(key => {
                        const keyButton = document.createElement('button');
                        keyButton.textContent = key;
                        keyButton.classList.add('keyboard-key', 'rounded-md', 'font-semibold', 'uppercase', 'bg-gray-500', 'flex-1');
                        if (key === 'ENTER' || key === '⌫') { keyButton.classList.add('px-1', 'text-xs'); keyButton.style.flex = '1.5'; }
                        keyButton.onclick = () => handleKeyPress(key);
                        rowDiv.appendChild(keyButton);
                    });
                    keyboardContainer.appendChild(rowDiv);
                });
            }

            function updateKeyboard(gameData) {
                const allGuesses = Object.values(gameData.players).flatMap(p => p.guesses);
                const keyStates = {};
                allGuesses.forEach(({ word, colors }) => {
                    for (let i = 0; i < word.length; i++) {
                        const letter = word[i];
                        const color = colors[i];
                        if (keyStates[letter] === 'correct') continue;
                        if (keyStates[letter] === 'present' && color !== 'correct') continue;
                        keyStates[letter] = color;
                    }
                });
                document.querySelectorAll('.keyboard-key').forEach(btn => {
                    const letter = btn.textContent;
                    const state = keyStates[letter];
                    btn.classList.remove('correct', 'present', 'absent');
                    if (state) btn.classList.add(state);
                });
            }
            
            function startTurnTimer() {
                stopTurnTimer();
                let timeLeft = 25;
                timerDisplay.textContent = timeLeft;
                timerDisplay.classList.remove('text-red-500');
                turnTimerInterval = setInterval(async () => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 3) timerDisplay.classList.add('text-red-500');
                    if (timeLeft <= 0) { stopTurnTimer(); await handleTimeUp(); }
                }, 1000);
            }

            function stopTurnTimer() {
                clearInterval(turnTimerInterval);
                turnTimerInterval = null;
                if (timerDisplay) timerDisplay.textContent = '';
            }

            async function handleTimeUp() {
                if (!isMyTurn) return;
                showToast("Süren doldu! Sıra rakibe geçti.");
                
                const gameRef = db.collection("games").doc(currentGameId);
                const gameDoc = await gameRef.get();
                if (!gameDoc.exists) return;
                const gameData = gameDoc.data();

                const failedGuess = { word: ''.padEnd(wordLength, ' '), colors: Array(wordLength).fill('failed') };
                const playerGuesses = gameData.players[userId].guesses || [];
                playerGuesses.push(failedGuess);
                
                const playerIds = Object.keys(gameData.players);
                const myIndex = playerIds.indexOf(userId);
                const nextPlayerIndex = (myIndex + 1) % playerIds.length;
                
                const updates = {
                    [`players.${userId}.guesses`]: playerGuesses,
                    currentPlayerId: playerIds[nextPlayerIndex]
                };

                const totalGuesses = Object.values(gameData.players).reduce((sum, p) => sum + p.guesses.length, 0);
                if (totalGuesses >= GUESS_COUNT) {
                    updates.status = 'finished';
                }
                await gameRef.update(updates);
            }

            function handleKeyPress(key) {
                if (isGameOver || !isMyTurn) return;
                const processedKey = key.toLocaleUpperCase('tr-TR');
                if (processedKey === 'ENTER') submitGuess();
                else if (processedKey === '⌫' || processedKey === 'BACKSPACE') deleteLetter();
                else if (processedKey.length === 1 && processedKey.match(/[A-ZÇĞİÖŞÜ]/)) addLetter(processedKey);
            }
            
            function addLetter(letter) {
                for (let i = 0; i < wordLength; i++) {
                    const tile = document.getElementById(`tile-${currentRow}-${i}`);
                    if (tile && tile.querySelector('.tile-inner').textContent === '') {
                        tile.querySelector('.tile-inner').textContent = letter;
                        break;
                    }
                }
            }

            function deleteLetter() {
                for (let i = wordLength - 1; i >= 0; i--) {
                    const tile = document.getElementById(`tile-${currentRow}-${i}`);
                    if (tile && tile.querySelector('.tile-inner').textContent !== '') {
                        tile.querySelector('.tile-inner').textContent = '';
                        break;
                    }
                }
            }

            async function submitGuess() {
                if (!isMyTurn || isGameOver) return;
                
                let guessWord = '';
                for (let i = 0; i < wordLength; i++) {
                    const tile = document.getElementById(`tile-${currentRow}-${i}`);
                    const tileInner = tile.querySelector('.tile-inner');
                    if (!tileInner || tileInner.textContent === '') { showToast("Kelime yeterince uzun değil!"); return; }
                    guessWord += tileInner.textContent;
                }
                
                if (!validWords[wordLength] || !validWords[wordLength].includes(guessWord)) {
                    showToast("Kelime sözlükte bulunamadı!");
                    return;
                }
                
                keyboardContainer.style.pointerEvents = 'none';
                stopTurnTimer();

                const gameRef = db.collection("games").doc(currentGameId);
                const gameDoc = await gameRef.get();
                const gameData = gameDoc.data();
                
                const secretWord = gameData.secretWord;
                const colors = calculateColors(guessWord, secretWord);
                
                const newGuess = { word: guessWord, colors: colors };
                const playerGuesses = gameData.players[userId].guesses || [];
                playerGuesses.push(newGuess);

                const playerIds = Object.keys(gameData.players);
                const myIndex = playerIds.indexOf(userId);
                const nextPlayerIndex = (myIndex + 1) % playerIds.length;
                
                const updates = {
                    [`players.${userId}.guesses`]: playerGuesses,
                    currentPlayerId: playerIds[nextPlayerIndex]
                };
                
                const totalGuessesMade = Object.values(gameData.players).reduce((sum, p) => sum + p.guesses.length, 0);
                
                if (guessWord === secretWord) {
                    updates.status = 'finished';
                    updates.roundWinner = userId;
                    const scoreToAdd = scorePoints[currentRow] || 0;
                    updates[`players.${userId}.score`] = (gameData.players[userId].score || 0) + scoreToAdd;
                } else if (totalGuessesMade >= GUESS_COUNT) {
                     updates.status = 'finished';
                     updates.roundWinner = null; 
                }

                await gameRef.update(updates).finally(() => { 
                    if(keyboardContainer) keyboardContainer.style.pointerEvents = 'auto'; 
                });
            }
            
            function showScoreboard(gameData) {
                gameScreen.classList.add('hidden');
                scoreboardScreen.classList.remove('hidden');

                const roundWinnerDisplay = document.getElementById('round-winner-display');
                const correctWordDisplay = document.getElementById('correct-word-display');
                const finalScores = document.getElementById('final-scores');

                correctWordDisplay.textContent = gameData.secretWord;

                if (gameData.roundWinner) {
                    const winnerName = gameData.players[gameData.roundWinner].username;
                    roundWinnerDisplay.textContent = `${winnerName} Kazandı!`;
                } else {
                    roundWinnerDisplay.textContent = "Berabere!";
                }

                finalScores.innerHTML = '<h3 class="text-xl font-bold mb-2 text-center">Toplam Puan</h3>';
                Object.values(gameData.players).forEach(player => {
                    const scoreEl = document.createElement('p');
                    scoreEl.className = 'text-lg';
                    scoreEl.textContent = `${player.username}: ${player.score} Puan`;
                    finalScores.appendChild(scoreEl);
                });
                
                if (userId === gameData.creatorId) {
                    newRoundBtn.classList.remove('hidden');
                } else {
                    newRoundBtn.classList.add('hidden');
                }
            }
            
            async function startNewRound() {
                if (!localGameData) return;
                
                const newWordList = wordLists[localGameData.wordLength];
                const newSecretWord = newWordList[Math.floor(Math.random() * newWordList.length)];
                
                const playerIds = Object.keys(localGameData.players);
                const newPlayersState = {};
                playerIds.forEach(pid => {
                    newPlayersState[pid] = {
                        ...localGameData.players[pid],
                        guesses: [] 
                    };
                });

                const updates = {
                    secretWord: newSecretWord,
                    players: newPlayersState,
                    currentPlayerId: localGameData.creatorId,
                    status: 'waiting',
                    winner: null,
                    roundWinner: null
                };

                const gameRef = db.collection("games").doc(currentGameId);
                await gameRef.update(updates);
            }


            function calculateColors(guess, secret) {
                const secretLetters = secret.split('');
                const guessLetters = guess.split('');
                const colors = Array(wordLength).fill('');
                for (let i = 0; i < wordLength; i++) {
                    if (guessLetters[i] === secretLetters[i]) {
                        colors[i] = 'correct';
                        secretLetters[i] = null;
                    }
                }
                for (let i = 0; i < wordLength; i++) {
                    if (colors[i] === '') {
                        const index = secretLetters.indexOf(guessLetters[i]);
                        if (index > -1) {
                            colors[i] = 'present';
                            secretLetters[index] = null;
                        } else {
                            colors[i] = 'absent';
                        }
                    }
                }
                return colors;
            }
            
            leaveGameBtn.onclick = leaveGame;
            createBtn.addEventListener('click', createGame);
            joinBtn.addEventListener('click', () => {
                const gameId = document.getElementById('game-id-input').value.toUpperCase();
                joinGame(gameId);
            });
            startGameBtn.addEventListener('click', async () => {
                if (!currentGameId) return;
                const gameRef = db.collection("games").doc(currentGameId);
                await gameRef.update({ status: 'playing' });
            });
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.altKey || e.metaKey) return;
                handleKeyPress(e.key);
            });
            mainMenuBtn.addEventListener('click', leaveGame);
            newRoundBtn.addEventListener('click', startNewRound);

            // --- Game Startup Logic ---
            if (typeof kelimeler4 === 'undefined' || typeof firebase === 'undefined') {
                showToast("Gerekli dosyalar yüklenemedi. Sayfayı yenileyin.");
            } else {
                wordLists = { 4: kelimeler4, 5: kelimeler5, 6: kelimeler6, 7: kelimeler7 };
                validWords = { 4: gecerliKelimeler4, 5: gecerliKelimeler5, 6: gecerliKelimeler6, 7: gecerliKelimeler7 };

                try {
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    auth = firebase.auth();
                } catch (e) {
                    console.error("Firebase initialization failed:", e);
                    showToast("Uygulama başlatılamadı.");
                }

                auth.signInAnonymously().then(() => {
                    auth.onAuthStateChanged(user => {
                        if (user) {
                            userId = user.uid;
                            createBtn.disabled = false;
                            joinBtn.disabled = false;
                        }
                    });
                }).catch(error => {
                    console.error("Anonymous sign-in failed:", error); 
                    showToast("Bağlantı hatası!");
                });
            }
        });
    </script>
</body>
</html>

